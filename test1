trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  NODE_VERSION: '18.x'

steps:
  - task: UseNode@1
    inputs:
      version: '$(NODE_VERSION)'

  # ðŸ”¹ Install frontend dependencies and build React
  - script: |
      npm install
      npm run build
    displayName: 'Build React App'

  # ðŸ”¹ Copy React build to backend
  - script: |
      mkdir -p backend/build
      cp -r build/* backend/build/
    displayName: 'Move React build to backend'

  # ðŸ”¹ Install backend dependencies
  - script: |
      cd backend
      npm install
    displayName: 'Install backend dependencies'

  # ðŸ”¹ Archive files for deployment
  - task: ArchiveFiles@2
    inputs:
      rootFolderOrFile: 'backend'
      archiveType: 'zip'
      archiveFile: '$(Build.ArtifactStagingDirectory)/app.zip'
      replaceExistingArchive: true

  # ðŸ”¹ Publish artifacts
  - task: PublishBuildArtifacts@1
    inputs:
      artifactName: 'drop'
