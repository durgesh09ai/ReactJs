import React, { useState, useCallback } from "react";
import {
  Box,
  TextField,
  Typography,
  Paper,
  Stack,
  } from "@mui/material";
import { useDropzone } from "react-dropzone";

interface BasicInfoFormProps {
  onSave?: (formData: FormData) => void;
}

interface FormData {
  solutionName: string;
  clientName: string;
  tags: string;
  images: string[];
}

export const CaseStudyBasicform: React.FC<BasicInfoFormProps> = ({ onSave }) => {
  const [formData, setFormData] = useState<FormData>({
    solutionName: "",
    clientName: "",
    tags: "",
    images: [],
  });

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setFormData((prev) => ({ ...prev, [name]: value }));
  };

  const handleDrop = useCallback((acceptedFiles: File[]) => {
    const newImages = acceptedFiles.map(file => URL.createObjectURL(file));
    setFormData(prev => ({ ...prev, images: [...prev.images, ...newImages] }));
  }, []);

  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    onDrop: handleDrop,
    accept: { "image/*": [] },
    multiple: true,
  });

  const handleSave = () => {
    if (onSave) {
      onSave(formData);
    }
  };

  return (
    <Paper
      elevation={0}
      sx={{
        width: { xs: "100%", md: "704px" },
        flexGrow: 1,
        p: 1,
        minHeight: "382px",
      }}
    >
      <Stack spacing={2}>
        <Box sx={{ display: "flex", alignItems: "center", gap: 1 }}>
          <img
            src="./formIcon.png"
            alt="Start icon"
            style={{ width: "20px", height: "20px" }}
          />
          <Typography variant="subtitle1">Start Your Story</Typography>
        </Box>

        <Typography variant="body2" color="text.secondary">
          General Information
        </Typography>

        <Box
          sx={{
            display: "flex",
            flexDirection: { xs: "column", md: "row" },
            gap: 4,
            width:'580px' 
          }}
        >
          {/* Left Column */}
          <Stack spacing={2} sx={{ flex: 1}}>
            <Box>
              <Typography variant="body2" gutterBottom>
                Name of the Case Study
              </Typography>
              <TextField
                required
                id="solutionName"
                name="solutionName"
                value={formData.solutionName}
                onChange={handleChange}
                placeholder="Enter name of the Case Study"
                fullWidth
                variant="outlined"
                size="small"
              />
            </Box>

            <Box>
              <Typography variant="body2" gutterBottom>
                Client Name
              </Typography>
              <TextField
                id="clientName"
                name="clientName"
                value={formData.clientName}
                onChange={handleChange}
                placeholder="Enter client name"
                fullWidth
                variant="outlined"
                size="small"
              />
            </Box>

            <Box>
              <Typography variant="body2" gutterBottom>
                Smart Tags
              </Typography>
              <TextField
                id="clientName"
                name="clientName"
                value={formData.clientName}
                onChange={handleChange}
                placeholder="Enter client name"
                fullWidth
                variant="outlined"
                size="small"
              />
            </Box>

           
          </Stack>

          {/* Right Column */}
          <Box sx={{ flex: 1 }}>
            <Typography variant="body2" gutterBottom>
              Upload Card images.
            </Typography>
            <Box
              {...getRootProps()}
              sx={{
                border: "2px dashed rgba(15,73,119,0.5)",
                padding: 2,
                borderRadius: 2,
                textAlign: "center",
                cursor: "pointer",
                mt: 2,
                minHeight: "100px", // Optional: setting a height for the drop area
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
              }}
            >


         <Box sx={{ display: "flex", gap: 2, mt: 2, flexWrap: "wrap" }}>
              {formData.images.map((img, idx) => (
                <img
                  key={idx}
                  src={img}
                  alt={`Upload preview ${idx}`}
                  style={{
                    width: "50px",
                    minHeight: "50px", 
                    display: "flex",
                    alignItems: "center",
                    textAlign: "center",
                     justifyContent: "center",
                     borderRadius: "10px",
                    padding: 2,
                  }}
                />
              ))}
            </Box>

              <input {...getInputProps()} />
              {isDragActive ? (
                <Typography variant="body2">Drop the files here ...</Typography>
              ) : (
                <img
                src="./add_file.svg"
                alt="Card image 2"
                style={{
                  width: "66px",
                  height: "auto",
                }}
              />              )}
            </Box>

          </Box>
        </Box>
      </Stack>


    </Paper>
  );
};
